{
  "name": "ğŸ“ Vapi Voice Agent - E-shop Customer Service",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "vapi-eshop",
        "options": {
          "responseMode": "responseNode"
        }
      },
      "id": "vapi-webhook",
      "name": "ğŸ“ Vapi Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [200, 400],
      "webhookId": "vapi-eshop"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json;\n\n// Vapi sends different message types\nconst messageType = input.message?.type || 'unknown';\n\n// Handle different Vapi events\nif (messageType === 'assistant-request') {\n  // Initial call setup - return assistant config\n  return {\n    json: {\n      type: 'assistant-request',\n      action: 'return_config'\n    }\n  };\n}\n\nif (messageType === 'function-call') {\n  // AI wants to call a function/tool\n  return {\n    json: {\n      type: 'function-call',\n      functionName: input.message.functionCall?.name,\n      parameters: input.message.functionCall?.parameters,\n      callId: input.message.functionCall?.id\n    }\n  };\n}\n\nif (messageType === 'transcript') {\n  // User said something - for logging\n  return {\n    json: {\n      type: 'transcript',\n      transcript: input.message.transcript,\n      role: input.message.role\n    }\n  };\n}\n\nif (messageType === 'end-of-call-report') {\n  // Call ended - for analytics\n  return {\n    json: {\n      type: 'end-of-call',\n      duration: input.message.durationSeconds,\n      cost: input.message.cost,\n      summary: input.message.summary\n    }\n  };\n}\n\n// Default - unknown type\nreturn {\n  json: {\n    type: messageType,\n    raw: input\n  }\n};"
      },
      "id": "parse-vapi-request",
      "name": "ğŸ” Parse Vapi Request",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [400, 400]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "assistant-request",
              "leftValue": "={{ $json.type }}",
              "rightValue": "assistant-request",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "function-call",
              "leftValue": "={{ $json.type }}",
              "rightValue": "function-call",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "end-of-call",
              "leftValue": "={{ $json.type }}",
              "rightValue": "end-of-call",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        }
      },
      "id": "route-vapi-type",
      "name": "ğŸ”€ Route by Type",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [600, 400]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"assistant\": {\n    \"model\": {\n      \"provider\": \"anthropic\",\n      \"model\": \"claude-sonnet-4-20250514\",\n      \"temperature\": 0.3,\n      \"messages\": [\n        {\n          \"role\": \"system\",\n          \"content\": \"Î•Î¯ÏƒÎ±Î¹ Î¿ AI Ï„Î·Î»ÎµÏ†Ï‰Î½Î¹ÎºÏŒÏ‚ Î²Î¿Î·Î¸ÏŒÏ‚ ÎµÎ¾Ï…Ï€Î·ÏÎ­Ï„Î·ÏƒÎ·Ï‚ Ï€ÎµÎ»Î±Ï„ÏÎ½ Î³Î¹Î± Ï„Î¿ Î·Î»ÎµÎºÏ„ÏÎ¿Î½Î¹ÎºÏŒ Î¼Î±Ï‚ ÎºÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î±.\\n\\nÎŸÎ”Î—Î“Î™Î•Î£:\\n- ÎœÎ¯Î»Î± Î Î‘ÎÎ¤Î‘ Î•Î»Î»Î·Î½Î¹ÎºÎ¬\\n- ÎÎ± ÎµÎ¯ÏƒÎ±Î¹ Ï†Î¹Î»Î¹ÎºÏŒÏ‚ ÎºÎ±Î¹ ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¹ÎºÏŒÏ‚\\n- ÎšÏÎ¬Ï„Î± Ï„Î¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ÏƒÏÎ½Ï„Î¿Î¼ÎµÏ‚ (Î³Î¹Î± Ï„Î·Î»Î­Ï†Ï‰Î½Î¿)\\n- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î± tools Î³Î¹Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î±\\n- Î‘Î½ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± Î²Î¿Î·Î¸Î®ÏƒÎµÎ¹Ï‚, Ï€ÏÏŒÏ„ÎµÎ¹Î½Îµ callback\\n\\nÎœÎ ÎŸÎ¡Î•Î™Î£ ÎÎ‘:\\n1. Î•Î»Î­Î³Î¾ÎµÎ¹Ï‚ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½\\n2. Î’ÏÎµÎ¹Ï‚ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±\\n3. Î‘Î½Î±Î¶Î·Ï„Î®ÏƒÎµÎ¹Ï‚ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î±\\n4. Î”ÏÏƒÎµÎ¹Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï„Î¹Î¼ÏÎ½\\n5. ÎšÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚ Î±Î¯Ï„Î·Î¼Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î®Ï‚\\n6. ÎœÎµÏ„Î±Ï†Î­ÏÎµÎ¹Ï‚ ÏƒÎµ Î±Î½Î¸ÏÏÏ€Î¹Î½Î¿ agent\"\n        }\n      ]\n    },\n    \"voice\": {\n      \"provider\": \"elevenlabs\",\n      \"voiceId\": \"pNInz6obpgDQGcFmaJgB\"\n    },\n    \"firstMessage\": \"Î“ÎµÎ¹Î± ÏƒÎ±Ï‚! ÎšÎ±Î»Ï‰ÏƒÎ®ÏÎ¸Î±Ï„Îµ ÏƒÏ„Î·Î½ ÎµÎ¾Ï…Ï€Î·ÏÎ­Ï„Î·ÏƒÎ· Ï€ÎµÎ»Î±Ï„ÏÎ½. Î ÏÏ‚ Î¼Ï€Î¿ÏÏ Î½Î± ÏƒÎ±Ï‚ Î²Î¿Î·Î¸Î®ÏƒÏ‰ ÏƒÎ®Î¼ÎµÏÎ±;\",\n    \"functions\": [\n      {\n        \"name\": \"check_stock\",\n        \"description\": \"Î•Î»Î­Î³Ï‡ÎµÎ¹ Î±Î½ Î­Î½Î± Ï€ÏÎ¿ÏŠÏŒÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"product_name\": {\n              \"type\": \"string\",\n              \"description\": \"Î¤Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚\"\n            }\n          },\n          \"required\": [\"product_name\"]\n        }\n      },\n      {\n        \"name\": \"track_order\",\n        \"description\": \"Î’ÏÎ¯ÏƒÎºÎµÎ¹ Ï„Î·Î½ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î¼Î¹Î±Ï‚ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"order_number\": {\n              \"type\": \"string\",\n              \"description\": \"ÎŸ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚\"\n            }\n          },\n          \"required\": [\"order_number\"]\n        }\n      },\n      {\n        \"name\": \"search_products\",\n        \"description\": \"Î‘Î½Î±Î¶Î·Ï„Î¬ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î± ÏƒÏ„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"search_query\": {\n              \"type\": \"string\",\n              \"description\": \"Î¤Î¹ ÏˆÎ¬Ï‡Î½ÎµÎ¹ Î¿ Ï€ÎµÎ»Î¬Ï„Î·Ï‚\"\n            },\n            \"max_price\": {\n              \"type\": \"number\",\n              \"description\": \"ÎœÎ­Î³Î¹ÏƒÏ„Î¿ budget\"\n            }\n          },\n          \"required\": [\"search_query\"]\n        }\n      },\n      {\n        \"name\": \"transfer_to_human\",\n        \"description\": \"ÎœÎµÏ„Î±Ï†Î­ÏÎµÎ¹ ÏƒÎµ Î±Î½Î¸ÏÏÏ€Î¹Î½Î¿ agent\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"reason\": {\n              \"type\": \"string\",\n              \"description\": \"Î›ÏŒÎ³Î¿Ï‚ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬Ï‚\"\n            }\n          },\n          \"required\": [\"reason\"]\n        }\n      }\n    ]\n  }\n}",
        "options": {}
      },
      "id": "return-assistant-config",
      "name": "âš™ï¸ Return Assistant Config",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "check_stock",
              "leftValue": "={{ $json.functionName }}",
              "rightValue": "check_stock",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "track_order",
              "leftValue": "={{ $json.functionName }}",
              "rightValue": "track_order",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "search_products",
              "leftValue": "={{ $json.functionName }}",
              "rightValue": "search_products",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "transfer_to_human",
              "leftValue": "={{ $json.functionName }}",
              "rightValue": "transfer_to_human",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        }
      },
      "id": "route-function",
      "name": "ğŸ”€ Route Function",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [850, 450]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "={{ $credentials.woocommerceApi.url }}/wp-json/wc/v3/products",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "search",
              "value": "={{ $('ğŸ”€ Route Function').item.json.parameters.product_name }}"
            },
            {
              "name": "per_page",
              "value": "3"
            },
            {
              "name": "status",
              "value": "publish"
            }
          ]
        },
        "options": {}
      },
      "id": "woo-check-stock",
      "name": "ğŸ›’ WooCommerce Stock",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 300],
      "credentials": {
        "httpBasicAuth": {
          "id": "WOO_CREDENTIAL_ID",
          "name": "WooCommerce API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const products = $input.first().json;\nconst callId = $('ğŸ”€ Route Function').item.json.callId;\n\nif (!products || products.length === 0) {\n  return {\n    json: {\n      callId,\n      result: \"Î”ÎµÎ½ Î²ÏÎ®ÎºÎ± Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€ÏÎ¿ÏŠÏŒÎ½. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î¼Î¿Ï… Ï€ÎµÎ¯Ï„Îµ Ï€Î¹Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î± Ï„Î¹ ÏˆÎ¬Ï‡Î½ÎµÏ„Îµ;\"\n    }\n  };\n}\n\nconst available = products.filter(p => p.stock_status === 'instock');\n\nif (available.length > 0) {\n  const p = available[0];\n  const result = `ÎÎ±Î¹, Î­Ï‡Î¿Ï…Î¼Îµ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï„Î¿ ${p.name} ÏƒÏ„Î·Î½ Ï„Î¹Î¼Î® ${p.price} ÎµÏ…ÏÏ. ${p.stock_quantity ? `ÎˆÏ‡Î¿Ï…Î¼Îµ ${p.stock_quantity} Ï„ÎµÎ¼Î¬Ï‡Î¹Î± ÏƒÎµ stock.` : ''} Î˜Î­Î»ÎµÏ„Îµ Î½Î± ÏƒÎ±Ï‚ Î´ÏÏƒÏ‰ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚;`;\n  return { json: { callId, result } };\n} else {\n  const p = products[0];\n  return { json: { callId, result: `Î”Ï…ÏƒÏ„Ï…Ï‡ÏÏ‚ Ï„Î¿ ${p.name} Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®. Î˜Î­Î»ÎµÏ„Îµ Î½Î± ÏƒÎ±Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ ÏŒÏ„Î±Î½ Î­ÏÎ¸ÎµÎ¹;` } };\n}"
      },
      "id": "format-stock-voice",
      "name": "ğŸ“ Format Stock Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1300, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "={{ $credentials.woocommerceApi.url }}/wp-json/wc/v3/orders/{{ $('ğŸ”€ Route Function').item.json.parameters.order_number }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "id": "woo-track-order",
      "name": "ğŸ›’ WooCommerce Order",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 450],
      "credentials": {
        "httpBasicAuth": {
          "id": "WOO_CREDENTIAL_ID",
          "name": "WooCommerce API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json;\nconst callId = $('ğŸ”€ Route Function').item.json.callId;\n\nif (response.statusCode === 404 || !response.body || response.body.code) {\n  return {\n    json: {\n      callId,\n      result: \"Î”ÎµÎ½ Î²ÏÎ®ÎºÎ± Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± Î¼Îµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î¼Î¿Ï… ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹ÏÏƒÎµÏ„Îµ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ;\"\n    }\n  };\n}\n\nconst order = response.body;\n\nconst statusMap = {\n  'pending': 'ÎµÎºÎºÏÎµÎ¼ÎµÎ¯ Î· Ï€Î»Î·ÏÏ‰Î¼Î®',\n  'processing': 'ÎµÏ„Î¿Î¹Î¼Î¬Î¶ÎµÏ„Î±Î¹ Î³Î¹Î± Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®',\n  'on-hold': 'ÏƒÎµ Î±Î½Î±Î¼Î¿Î½Î®',\n  'completed': 'Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ ÎºÎ±Î¹ Ï€Î±ÏÎ±Î´ÏŒÎ¸Î·ÎºÎµ',\n  'cancelled': 'Î±ÎºÏ…ÏÏÎ¸Î·ÎºÎµ',\n  'refunded': 'Î­Î³Î¹Î½Îµ ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î® Ï‡ÏÎ·Î¼Î¬Ï„Ï‰Î½',\n  'shipped': 'Î­Ï‡ÎµÎ¹ Î±Ï€Î¿ÏƒÏ„Î±Î»ÎµÎ¯ ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ ÎºÎ±Î¸Î¿Î´ÏŒÎ½'\n};\n\nconst status = statusMap[order.status] || order.status;\nconst trackingMeta = order.meta_data?.find(m => m.key.includes('tracking'));\nconst tracking = trackingMeta ? ` ÎŸ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®Ï‚ ÎµÎ¯Î½Î±Î¹ ${trackingMeta.value}.` : '';\n\nconst result = `Î— Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± ÏƒÎ±Ï‚ Î¼Îµ Î±ÏÎ¹Î¸Î¼ÏŒ ${order.id} ${status}. Î¤Î¿ ÏƒÏÎ½Î¿Î»Î¿ Î®Ï„Î±Î½ ${order.total} ÎµÏ…ÏÏ.${tracking}`;\n\nreturn { json: { callId, result } };"
      },
      "id": "format-order-voice",
      "name": "ğŸ“ Format Order Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1300, 450]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "={{ $credentials.woocommerceApi.url }}/wp-json/wc/v3/products",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "search",
              "value": "={{ $('ğŸ”€ Route Function').item.json.parameters.search_query }}"
            },
            {
              "name": "per_page",
              "value": "5"
            },
            {
              "name": "status",
              "value": "publish"
            },
            {
              "name": "max_price",
              "value": "={{ $('ğŸ”€ Route Function').item.json.parameters.max_price || '' }}"
            }
          ]
        },
        "options": {}
      },
      "id": "woo-search",
      "name": "ğŸ›’ WooCommerce Search",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 600],
      "credentials": {
        "httpBasicAuth": {
          "id": "WOO_CREDENTIAL_ID",
          "name": "WooCommerce API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const products = $input.first().json;\nconst callId = $('ğŸ”€ Route Function').item.json.callId;\n\nif (!products || products.length === 0) {\n  return {\n    json: {\n      callId,\n      result: \"Î”ÎµÎ½ Î²ÏÎ®ÎºÎ± Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î± Î¼Îµ Î±Ï…Ï„Î¬ Ï„Î± ÎºÏÎ¹Ï„Î®ÏÎ¹Î±. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î¼Î¿Ï… Ï€ÎµÎ¯Ï„Îµ Ï€Î¹Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î± Ï„Î¹ ÏˆÎ¬Ï‡Î½ÎµÏ„Îµ;\"\n    }\n  };\n}\n\nconst available = products.filter(p => p.stock_status === 'instock').slice(0, 3);\n\nif (available.length === 0) {\n  return {\n    json: {\n      callId,\n      result: \"Î’ÏÎ®ÎºÎ± ÎºÎ¬Ï€Î¿Î¹Î± Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î± Î±Î»Î»Î¬ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®. Î˜Î­Î»ÎµÏ„Îµ Î½Î± ÏƒÎ±Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ ÏŒÏ„Î±Î½ Î­ÏÎ¸Î¿Ï…Î½;\"\n    }\n  };\n}\n\nlet result = `Î’ÏÎ®ÎºÎ± ${available.length} Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î±. `;\n\navailable.forEach((p, i) => {\n  result += `${i + 1}. ${p.name} ÏƒÏ„Î± ${p.price} ÎµÏ…ÏÏ. `;\n});\n\nresult += \"Î Î¿Î¹Î¿ ÏƒÎ±Ï‚ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎµÎ¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿;\";\n\nreturn { json: { callId, result } };"
      },
      "id": "format-search-voice",
      "name": "ğŸ“ Format Search Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1300, 600]
    },
    {
      "parameters": {
        "jsCode": "const params = $('ğŸ”€ Route Function').item.json.parameters;\nconst callId = $('ğŸ”€ Route Function').item.json.callId;\n\n// Log transfer request\nconst ticketId = 'TKT-' + Date.now().toString(36).toUpperCase();\n\nconst result = `Î•Î½Ï„Î¬Î¾ÎµÎ¹, Î¸Î± ÏƒÎ±Ï‚ ÏƒÏ…Î½Î´Î­ÏƒÏ‰ Î¼Îµ Î­Î½Î±Î½ ÏƒÏ…Î½Î¬Î´ÎµÎ»Ï†Î¿. ÎŸ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚ ÏƒÎ±Ï‚ ÎµÎ¯Î½Î±Î¹ ${ticketId}. Î Î±ÏÎ±ÎºÎ±Î»Ï Î¼ÎµÎ¯Î½ÎµÏ„Îµ ÏƒÏ„Î· Î³ÏÎ±Î¼Î¼Î®.`;\n\nreturn {\n  json: {\n    callId,\n    result,\n    ticketId,\n    reason: params.reason,\n    action: 'transfer'\n  }\n};"
      },
      "id": "process-transfer",
      "name": "ğŸ“ Process Transfer",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1100, 750]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"result\": \"{{ $json.result }}\"\n}",
        "options": {}
      },
      "id": "respond-function",
      "name": "ğŸ“¤ Return Function Result",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1500, 450]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://hooks.slack.com/services/YOUR_SLACK_WEBHOOK",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"text\": \"ğŸ“ Î¤Î­Î»Î¿Ï‚ ÎºÎ»Î®ÏƒÎ·Ï‚ AI Voice Agent\",\n  \"attachments\": [{\n    \"color\": \"#36a64f\",\n    \"fields\": [\n      {\"title\": \"Î”Î¹Î¬ÏÎºÎµÎ¹Î±\", \"value\": \"{{ $json.duration }} Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±\", \"short\": true},\n      {\"title\": \"ÎšÏŒÏƒÏ„Î¿Ï‚\", \"value\": \"${{ $json.cost }}\", \"short\": true},\n      {\"title\": \"Î ÎµÏÎ¯Î»Î·ÏˆÎ·\", \"value\": \"{{ $json.summary || 'N/A' }}\", \"short\": false}\n    ]\n  }]\n}",
        "options": {}
      },
      "id": "log-call-end",
      "name": "ğŸ“Š Log Call End",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [850, 600]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{ \"status\": \"logged\" }",
        "options": {}
      },
      "id": "respond-end-call",
      "name": "ğŸ“¤ Respond End Call",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1050, 600]
    }
  ],
  "connections": {
    "ğŸ“ Vapi Webhook": {
      "main": [
        [
          {
            "node": "ğŸ” Parse Vapi Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” Parse Vapi Request": {
      "main": [
        [
          {
            "node": "ğŸ”€ Route by Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ Route by Type": {
      "main": [
        [
          {
            "node": "âš™ï¸ Return Assistant Config",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ”€ Route Function",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“Š Log Call End",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ Route Function": {
      "main": [
        [
          {
            "node": "ğŸ›’ WooCommerce Stock",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ›’ WooCommerce Order",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ›’ WooCommerce Search",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“ Process Transfer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ›’ WooCommerce Stock": {
      "main": [
        [
          {
            "node": "ğŸ“ Format Stock Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ Format Stock Response": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Return Function Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ›’ WooCommerce Order": {
      "main": [
        [
          {
            "node": "ğŸ“ Format Order Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ Format Order Response": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Return Function Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ›’ WooCommerce Search": {
      "main": [
        [
          {
            "node": "ğŸ“ Format Search Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ Format Search Response": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Return Function Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ Process Transfer": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Return Function Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Log Call End": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Respond End Call",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [
    {
      "name": "Voice",
      "createdAt": "2024-01-01T00:00:00.000Z"
    },
    {
      "name": "Vapi",
      "createdAt": "2024-01-01T00:00:00.000Z"
    },
    {
      "name": "Customer Service",
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  ]
}
